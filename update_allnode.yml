---
- name: update allnode
  hosts: all
  become: false
  gather_facts: yes

  tasks:
    - name: apt update
      ansible.builtin.apt:
        update_cache: yes
        state: present
      become: yes
      retries: 3
      delay: 5
      when: ansible_facts['distribution'] in ['Ubuntu']
    - name: apt upgrade
      ansible.builtin.apt:
        upgrade: yes
        state: latest
      become: yes
      retries: 3
      delay: 5
      when: ansible_facts['distribution'] in ['Ubuntu']
    - name: apt autoremove
      ansible.builtin.apt:
        autoremove: yes
      become: yes
      when: ansible_facts['distribution'] in ['Ubuntu']
    - name: apt autoclean
      ansible.builtin.apt:
        autoclean: yes
      become: yes
      when: ansible_facts['distribution'] in ['Ubuntu']

    - name: yum update
      ansible.builtin.yum:
        name: "*"
        state: latest
      become: yes
      when: ansible_facts['os_family'] in ['RedHat']
